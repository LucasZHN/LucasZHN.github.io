<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>STAT3整理</title>
    <link href="/2023/01/03/STAT3%20%E6%95%B4%E7%90%86/"/>
    <url>/2023/01/03/STAT3%20%E6%95%B4%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p><em>本案例用于BAIC ZHENGJIANG 以及 NISSAN HUADU 与 NISSAN ZHENGZHOU. 用于在SLSE11与15之间传输车辆数据以及检测结果数据。</em></p><span id="more"></span><p>本文提到的服务器信息应如下：<br>Hostname:Version:Role:Nickname<br>ZHJ1A(OLD):SLSE11:Source:src. server (SLSE11)<br>ZHJ1A(NEW):SLSE15:Destination:dest. server (SLSE15)</p><h1 id="1-Start-up"><a href="#1-Start-up" class="headerlink" title="1 Start-up"></a>1 Start-up</h1><h2 id="1-1-Install-the-rpm-if-not-installed"><a href="#1-1-Install-the-rpm-if-not-installed" class="headerlink" title="1.1 Install the .rpm if not installed"></a>1.1 Install the .rpm if not installed</h2><p>On src. server (SLSE11):</p><figure class="highlight bash"><figcaption><span>nums</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">zypper install ./stat3conv-export-1.0.8-482.1.sle11.x86_64.rpm<br></code></pre></td></tr></table></figure><p>On dest. server (SLSE15):</p><figure class="highlight bash"><figcaption><span>nums</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">zypper install ./stat3conv-import-1.0.8-482.1.x86_64.rpm<br></code></pre></td></tr></table></figure><h2 id="1-2-Close-firewall-on-dest-server-SLSE15"><a href="#1-2-Close-firewall-on-dest-server-SLSE15" class="headerlink" title="1.2 Close firewall on dest. server (SLSE15):"></a>1.2 Close firewall on dest. server (SLSE15):</h2><p>on dest. server (SLSE15):</p><figure class="highlight bash"><figcaption><span>nums</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">disable</span> --now firewalld.service<br></code></pre></td></tr></table></figure><h2 id="1-3-Add-dest-server-SLSE15-on-src-server-SLSE11"><a href="#1-3-Add-dest-server-SLSE15-on-src-server-SLSE11" class="headerlink" title="1.3 Add dest. server(SLSE15) on src. server(SLSE11)"></a>1.3 Add dest. server(SLSE15) on src. server(SLSE11)</h2><p>On src. server (SLSE11):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - <br>/opt/dsa/tools/bin/configure_source_prodsvr_for_stat3conv update &lt;ip_of_target_host&gt;<br></code></pre></td></tr></table></figure><h2 id="1-4-Update-configuration"><a href="#1-4-Update-configuration" class="headerlink" title="1.4 Update configuration"></a>1.4 Update configuration</h2><p>on dest. server (SLSE15):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - prodis<br>dbupdate -v <br><span class="hljs-built_in">cd</span> /data/install/stat3_migration/cfg /opt/dsa/tools/bin/configure_archive_settings_in_db_for_stat3conv backup result_settings_orig.sql<br>/opt/dsa/tools/bin/configure_archive_settings_in_db_for_stat3conv restore result_settings_for_migration.sql<br>su - <br>/opt/dsa/tools/bin/configure_target_statserver_for_stat3conv update<br></code></pre></td></tr></table></figure><h2 id="1-5-Avoiding-violation"><a href="#1-5-Avoiding-violation" class="headerlink" title="1.5 Avoiding violation"></a>1.5 Avoiding violation</h2><p>on dest. server (SLSE15):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - prodis <br>/opt/dsa/tools/bin/before_migration_stat3conv.sh<br></code></pre></td></tr></table></figure><h2 id="1-6-Compare-home-prodis-cfg-prodatdef-xml"><a href="#1-6-Compare-home-prodis-cfg-prodatdef-xml" class="headerlink" title="1.6 Compare  /home/prodis/cfg/prodatdef.xml"></a>1.6 Compare  /home/prodis/cfg/prodatdef.xml</h2><p>当有不同时，以src. server (SLSE11)为准。</p><h1 id="2-Migration"><a href="#2-Migration" class="headerlink" title="2. Migration"></a>2. Migration</h1><h2 id="2-1-Result-data"><a href="#2-1-Result-data" class="headerlink" title="2.1 Result data"></a>2.1 Result data</h2><h3 id="2-1-1-Command"><a href="#2-1-1-Command" class="headerlink" title="2.1.1 Command"></a>2.1.1 Command</h3><p>On src. server (SLSE11):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">screen<br>/opt/dsa/tools/bin/resexportstatisticsyear_stat3conv &lt;YYYY&gt;<br></code></pre></td></tr></table></figure><h3 id="2-1-2-Multi-task-processing"><a href="#2-1-2-Multi-task-processing" class="headerlink" title="2.1.2 Multi-task processing"></a>2.1.2 Multi-task processing</h3><p>on dest. server (SLSE15):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /usr/lib/systemd/system/jsonres2sql-act.service /usr/lib/systemd/system/jsonres2sql&lt;NUM&gt;-act.service<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start jsonres2sql*<br>systemctl stop jsonres2sql.service<br></code></pre></td></tr></table></figure><h3 id="2-1-3-Archiving"><a href="#2-1-3-Archiving" class="headerlink" title="2.1.3 Archiving"></a>2.1.3 Archiving</h3><p>On src. server (SLSE11):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">copy_year_to_archive_stat3conv &lt;YYYY&gt;<br></code></pre></td></tr></table></figure><h3 id="2-1-4-Proceed-to-the-next-year"><a href="#2-1-4-Proceed-to-the-next-year" class="headerlink" title="2.1.4 Proceed to the next year"></a>2.1.4 Proceed to the next year</h3><h2 id="2-2-vehicle-data"><a href="#2-2-vehicle-data" class="headerlink" title="2.2 vehicle data"></a>2.2 vehicle data</h2><h2 id="2-1-Open-services"><a href="#2-1-Open-services" class="headerlink" title="2.1 Open services"></a>2.1 Open services</h2><p>On src. server (SLSE11):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start prodatintegrate-act.service<br></code></pre></td></tr></table></figure><p>on dest. server (SLSE15):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start prodatintegrate.service<br></code></pre></td></tr></table></figure><h2 id="2-2-Commands"><a href="#2-2-Commands" class="headerlink" title="2.2 Commands"></a>2.2 Commands</h2><p>On src. server (SLSE11):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">resexportfzd_stat3conv 1<br></code></pre></td></tr></table></figure><h1 id="3-After-migration-is-done"><a href="#3-After-migration-is-done" class="headerlink" title="3. After migration is done"></a>3. After migration is done</h1><p>On src. server (SLSE11):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - prodis <br>/opt/dsa/tools/bin/after_migration_stat3conv.sh<br>su - root<br>configure_source_prodsvr_for_stat3conv restore<br></code></pre></td></tr></table></figure><p>on dest. server (SLSE15):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - root<br>configure_target_statserver_for_stat3conv restore<br>su - prodis<br><span class="hljs-built_in">cd</span> /data/install/stat3_migration/cfg <br><br>configure_archive_settings_in_db_for_stat3conv restore result_settings_orig.sql<br></code></pre></td></tr></table></figure><p>and backup</p>]]></content>
    
    
    
    <tags>
      
      <tag>DSA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PostgreSQL SETUP in DSA Shanghai</title>
    <link href="/2022/12/28/PostgreSQL%20SETUP%20in%20DSA%20Shanghai/"/>
    <url>/2022/12/28/PostgreSQL%20SETUP%20in%20DSA%20Shanghai/</url>
    
    <content type="html"><![CDATA[<p><em>本案例用于PRODIS.Server 建立postgresql数据，随版本需要有所更改。</em></p><span id="more"></span><p><strong>以下在active上操作。</strong></p><h1 id="1-开启maintenance-进入手动模式-并删除现有数据库"><a href="#1-开启maintenance-进入手动模式-并删除现有数据库" class="headerlink" title="1. 开启maintenance,进入手动模式,并删除现有数据库"></a>1. 开启maintenance,进入手动模式,并删除现有数据库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - root<br>systemctl start pacemaker<br>crm maintenance on<br>systemctl isolate multi-user.target<br>systemctl stop cron.service<br>systemctl <span class="hljs-built_in">disable</span> --now postgresql.service<br><span class="hljs-built_in">rm</span> -rf /data/postgres/db/*<br></code></pre></td></tr></table></figure><h1 id="2-启动新数据库"><a href="#2-启动新数据库" class="headerlink" title="2. 启动新数据库"></a>2. 启动新数据库</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - postgres<br>/usr/bin/initdb --auth=ident /data/postgres/db/<br>pg_ctl start -D /data/postgres/db/ -o <span class="hljs-string">&#x27;-c config_file=/etc/postgresql/prodis/postgresql.conf&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="3-导入dump"><a href="#3-导入dump" class="headerlink" title="3. 导入dump"></a>3. 导入dump</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">db_restore_schema.sh -v prodis /data/postgres/dump/*.dmp<br></code></pre></td></tr></table></figure><h1 id="4-更新PostgresSQL数据库结构"><a href="#4-更新PostgresSQL数据库结构" class="headerlink" title="4. 更新PostgresSQL数据库结构"></a>4. 更新PostgresSQL数据库结构</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - prodis<br>dbupdate -v -i /etc/prodis/tmp_dbupdate.ini<br></code></pre></td></tr></table></figure><h1 id="5-生成clone"><a href="#5-生成clone" class="headerlink" title="5. 生成clone"></a>5. 生成clone</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - root<br>pg_logship_init -f<br></code></pre></td></tr></table></figure><h1 id="6-在passive上clone数据库"><a href="#6-在passive上clone数据库" class="headerlink" title="6. 在passive上clone数据库"></a>6. 在passive上clone数据库</h1><blockquote><p><em><strong>注意passive上不可直接恢复dmp</strong></em></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">crm maintenance on<br>pg_logship_setup<br></code></pre></td></tr></table></figure><h1 id="7-开启DSA-prodis进程"><a href="#7-开启DSA-prodis进程" class="headerlink" title="7. 开启DSA prodis进程"></a>7. 开启DSA prodis进程</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - root<br>systemctl start cron.service<br>systemctl isolate prodis-active.target<br>systemctl <span class="hljs-built_in">enable</span> --now pacemaker<br>crm m on<br>crm n stand<br>TERM=linux yast prodiscluster<br></code></pre></td></tr></table></figure><h1 id="8-检查是否存在问题"><a href="#8-检查是否存在问题" class="headerlink" title="8. 检查是否存在问题"></a>8. 检查是否存在问题</h1><h2 id="8-1-热备"><a href="#8-1-热备" class="headerlink" title="8.1 热备"></a>8.1 热备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crm_mon -Ar<br></code></pre></td></tr></table></figure><p>应得到以下类似输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">Stack: corosync<br>Current DC: UPS-MEBANTING1A (version 2.0.1+20190417.13d370ca9-3.15.1-2.0.1+20190417.13d370ca9) - partition with quorum<br>Last updated: Thu Jan 20 13:17:40 2022<br>Last change: Thu Jan 20 11:54:55 2022 by root via crm_attribute on UPS-MEBANTING1A<br><br>2 nodes configured<br>11 resources configured<br><br>Online: [ UPS-MEBANTING1A UPS-MEBANTING1B ]<br><br>Full list of resources:<br><br> Resource Group: host1-group<br>     host1ip    (ocf::heartbeat:IPaddr2):       Started UPS-MEBANTING1A<br>     sysmode-act        (service:sysmode-act):  Started UPS-MEBANTING1A<br> Resource Group: host2-group<br>     sysmode-psv        (service:sysmode-psv):  Started UPS-MEBANTING1B<br> Clone Set: prodis-ha [prodis] (promotable)<br>     Masters: [ UPS-MEBANTING1A ]<br>     Slaves: [ UPS-MEBANTING1B ]<br> Clone Set: ping-ha [ping-nodes]<br>     Started: [ UPS-MEBANTING1A UPS-MEBANTING1B ]<br> Clone Set: notify-ha [monitor-nodes]<br>     Started: [ UPS-MEBANTING1A UPS-MEBANTING1B ]<br> Clone Set: pgsql-ha [pgsqld] (promotable)<br>     Masters: [ UPS-MEBANTING1A ]<br>     Slaves: [ UPS-MEBANTING1B ]<br><br>Node Attributes:<br>* Node UPS-MEBANTING1A:<br>    + master-pgsqld                     : 1001<br>    + master-prodis                     : 1000<br>    + pingd                             : 100<br>    + status                            : master<br>* Node UPS-MEBANTING1B:<br>    + master-pgsqld                     : 1000<br>    + master-prodis                     : 1000<br>    + pingd                             : 100<br>    + status                            : slave<br><br></code></pre></td></tr></table></figure><h2 id="8-检查active情况"><a href="#8-检查active情况" class="headerlink" title="8.检查active情况"></a>8.检查active情况</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">prodis-status<br>isactive<br></code></pre></td></tr></table></figure><h2 id="查询pgsql库是否可写"><a href="#查询pgsql库是否可写" class="headerlink" title="查询pgsql库是否可写"></a>查询pgsql库是否可写</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> pg_is_in_recovery();<br></code></pre></td></tr></table></figure><p>应得到</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">postgres<span class="hljs-operator">=</span># <span class="hljs-keyword">select</span> pg_is_in_recovery();<br> pg_is_in_recovery <br><span class="hljs-comment">-------------------</span><br> f<br>(<span class="hljs-number">1</span> <span class="hljs-type">row</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>DSA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Lucas&#39; Doodle</title>
    <link href="/2022/12/12/Lucas%E2%80%98s%20Doodle/"/>
    <url>/2022/12/12/Lucas%E2%80%98s%20Doodle/</url>
    
    <content type="html"><![CDATA[<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p>这里是我随手写写的地方，万一之后哪天这里的一条命令就用上了呢</p><span id="more"></span><h1 id="1-杀进程"><a href="#1-杀进程" class="headerlink" title="1. 杀进程"></a>1. 杀进程</h1><h2 id="1-1-进程名"><a href="#1-1-进程名" class="headerlink" title="1.1 进程名"></a>1.1 进程名</h2><p>现已知一进程突然无限增长，将load average拖至300+。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps aux|grep &lt;Process name&gt;|awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>|xargs <span class="hljs-built_in">kill</span> -9<br></code></pre></td></tr></table></figure><ul><li>使用 <code>ps aux</code> 显示所有用户的进程</li><li>使用 <code>grep $ProcessName</code> 找到含有$ProcessName的所有进程</li><li>使用 <code>awk &#39;&#123;print $2&#125;&#39;</code> 输出该进程的进程号</li><li>使用 <code>xargs kill -9</code> 执行9号信号，Kill signal（杀死进程信号，linux规定进程不可以忽略这个信号）</li></ul><h2 id="1-2-僵尸进程"><a href="#1-2-僵尸进程" class="headerlink" title="1.2 僵尸进程"></a>1.2 僵尸进程</h2><p>在 Linux 系统中，正常情况下，子进程死亡后其父进程会接收到通知进行一些例如释放内存之类的清理操作。但是，如果父进程未收到通知察觉子进程死亡，那么子进程就进入了“僵死”状态。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -A -ostat,pid,ppid|grep -e <span class="hljs-string">&#x27;[zZ]&#x27;</span>|awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>|xargs <span class="hljs-built_in">kill</span> -9<br></code></pre></td></tr></table></figure><ul><li>使用 <code>ps -A -ostat,pid,ppid|grep -e &#39;[zZ]&#39;</code> 输出僵尸进程的 PID 及其父进程的 PID</li><li>使用 <code>awk &#39;&#123;print $2&#125;&#39;</code> 输出该进程的进程号</li><li>使用 <code>xargs kill -9</code> 执行9号信号，Kill signal（杀死进程信号，linux规定进程不可以忽略这个信号）</li></ul><h2 id="相关：踢终端"><a href="#相关：踢终端" class="headerlink" title="相关：踢终端"></a>相关：踢终端</h2><p>按照终端号踢出用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pkill -9 -t <span class="hljs-variable">$terminalName</span><br></code></pre></td></tr></table></figure><h1 id="2-wsl挂载samba或主机移动设备报错"><a href="#2-wsl挂载samba或主机移动设备报错" class="headerlink" title="2. wsl挂载samba或主机移动设备报错"></a>2. wsl挂载samba或主机移动设备报错</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌─[root@DSASH-ZYJ] - [/mnt] - [2022-09-19 09:30:42]<br>└─[1] ll<br><span class="hljs-built_in">ls</span>: cannot access <span class="hljs-string">&#x27;e&#x27;</span>: Invalid argument<br><span class="hljs-built_in">ls</span>: cannot access <span class="hljs-string">&#x27;smb254&#x27;</span>: Transport endpoint is not connected<br><span class="hljs-built_in">ls</span>: cannot access <span class="hljs-string">&#x27;smb85&#x27;</span>: Transport endpoint is not connected<br>total 0<br>drwxrwxrwx 1 root root 4.0K Sep 15 14:48 c<br>drwxrwxrwx 1 root root 4.0K Sep 16 16:40 d<br>d????????? ? ?    ?       ?            ? e<br>drwxr-xr-x 1 root root 4.0K Aug 12 10:59 f<br>d????????? ? ?    ?       ?            ? smb254<br>d????????? ? ?    ?       ?            ? smb85<br></code></pre></td></tr></table></figure><blockquote><p>ls: cannot access ‘e’: Invalid argument<br>ls: cannot access ‘smb254’: Transport endpoint is not connected<br>ls: cannot access ‘smb85’: Transport endpoint is not connected<br>这通常是由于文件系统崩溃导致挂载目录未挂载。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">umount -l /mnt<br></code></pre></td></tr></table></figure><p>lazy umount正是针对上面错误中的busy而提出的，即可以卸载“busy”的文件系统。选项–l并不是马上umount，而是在该目录空闲后再umount。卸载完成后再重新挂载或mount -a恢复/etc/fstab即可。</p><h1 id="3-从Linux系统文件中检查服务器网线连接情况。"><a href="#3-从Linux系统文件中检查服务器网线连接情况。" class="headerlink" title="3. 从Linux系统文件中检查服务器网线连接情况。"></a>3. 从Linux系统文件中检查服务器网线连接情况。</h1><blockquote><p>20220920使用clonezilla恢复flash station</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /sys/class/net/eth0/carrier<br></code></pre></td></tr></table></figure><ul><li>若返回为 <code>1</code> 则网线连接上了</li><li>若返回为 <code>0</code> 则网线未连接</li><li>也有可能输出 <code>cat: /sys/class/net/eth9/carrier: Invalid argument</code> 则开启网口后（ <code>ip link set eth9 up</code> ）再看</li></ul><h1 id="4-clonezilla-在恢复系统后找不到启动项，进入-grub"><a href="#4-clonezilla-在恢复系统后找不到启动项，进入-grub" class="headerlink" title="4. clonezilla 在恢复系统后找不到启动项，进入 grub"></a>4. clonezilla 在恢复系统后找不到启动项，进入 grub</h1><p>在安装完毕后可能会无法找到系统，进入grub启动项的问题</p><ol><li> 使用UFEI启动模式</li><li> 找到UFEI启动项配置</li><li> 添加硬盘中的EFI/opensuse/grubx86.efi为“opensuse”</li><li> 把opensuse提升为启动项第一位</li></ol><h1 id="5-导出postgresql表至-sql"><a href="#5-导出postgresql表至-sql" class="headerlink" title="5. 导出postgresql表至 *.sql"></a>5. 导出postgresql表至 <code>*.sql</code></h1><p>#数据库</p><h2 id="5-1-已经有DSA自己写的save-db导出一整个dump，仍需要某个表导出内容。"><a href="#5-1-已经有DSA自己写的save-db导出一整个dump，仍需要某个表导出内容。" class="headerlink" title="5.1 已经有DSA自己写的save.db导出一整个dump，仍需要某个表导出内容。"></a>5.1 已经有DSA自己写的save.db导出一整个dump，仍需要某个表导出内容。</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pg_dump -h localhost -p 5432 -U prodis prodis -t prodat_vehicle --inserts &gt;/data/mysql.sql<br></code></pre></td></tr></table></figure><ul><li><code>pg_dump</code> 导出postgresql命令</li><li><code>-h</code> , –host=主机名 数据库服务器的主机名或套接字目录</li><li><code>-p</code> , –port=端口号 数据库服务器的端口号</li><li><code>-U</code> , –username=用户名 以指定的数据库用户联接</li><li>第二个 <code>prodis</code> 数据库名</li><li><code>-t</code> , –table=TABLE 只转储指定名称的表</li><li><code>--inserts</code>, 以INSERT命令，而不是COPY命令的形式转储数据</li></ul><h2 id="5-2-在没有DSA的save-db下导出dump"><a href="#5-2-在没有DSA的save-db下导出dump" class="headerlink" title="5.2 在没有DSA的save.db下导出dump"></a>5.2 在没有DSA的save.db下导出dump</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pg_dump -v -U prodis -f /data/tmp/lucas/all.sql<br></code></pre></td></tr></table></figure><ul><li><code>-v</code> , –verbose, 详细模式</li><li><code>-f</code> , –file=文件名 输出文件名</li></ul><h2 id="5-3-pg-dump-常用参数列表。"><a href="#5-3-pg-dump-常用参数列表。" class="headerlink" title="5.3 pg_dump 常用参数列表。"></a>5.3 <code>pg_dump</code> 常用参数列表。</h2><ol><li> 一般选项</li></ol><table><thead><tr><th align="right">参数</th><th align="left">作用</th></tr></thead><tbody><tr><td align="right">-f, –file=文件名</td><td align="left">输出文件名</td></tr><tr><td align="right">-F, –format=c/t/p</td><td align="left">输出文件格式(定制,tar, 明文)</td></tr><tr><td align="right">-v, –verbose</td><td align="left">详细模式</td></tr><tr><td align="right">-Z, –compress=0-9</td><td align="left">被压缩格式的压缩级别</td></tr><tr><td align="right">–lock-wait-timeout=TIMEOUT</td><td align="left">在等待表锁超时后操作失败</td></tr><tr><td align="right">–help</td><td align="left">显示帮助信息,然后退出</td></tr><tr><td align="right">–version</td><td align="left">输出版本信息,然后退出</td></tr></tbody></table><ol start="2"><li> 控制输出内容选项</li></ol><table><thead><tr><th align="right">参数</th><th align="left">作用</th></tr></thead><tbody><tr><td align="right">-a, –data-only</td><td align="left">只转储数据,不包括模式</td></tr><tr><td align="right">-s, –schema-only</td><td align="left">只转储模式,不包括数据</td></tr><tr><td align="right">-t, –table=TABLE</td><td align="left">只转储指定名称的表</td></tr><tr><td align="right">-T, –exclude-table=TABLE</td><td align="left">不转储指定名称的表</td></tr><tr><td align="right">-b, –blobs</td><td align="left">在转储中包括大对象</td></tr><tr><td align="right">-c, –clean</td><td align="left">在重新创建之前，先清除（删除）数据库对象</td></tr><tr><td align="right">-C, –create</td><td align="left">在转储中包括命令,以便创建数据库</td></tr><tr><td align="right">-E, –encoding=ENCODING</td><td align="left">转储以ENCODING形式编码的数据</td></tr><tr><td align="right">-n, –schema=SCHEMA</td><td align="left">只转储指定名称的模式</td></tr><tr><td align="right">-N,–exclude-schema=SCHEMA</td><td align="left">不转储已命名的模式</td></tr><tr><td align="right">-o, –oids</td><td align="left">在转储中包括OID</td></tr><tr><td align="right">-O, –no-owner</td><td align="left">在明文格式中,忽略恢复对象所属者</td></tr><tr><td align="right">-S, –superuser=NAME</td><td align="left">在转储中, 指定的超级用户名</td></tr><tr><td align="right">-x, –no-privileges</td><td align="left">不要转储权限 (grant/revoke)</td></tr><tr><td align="right">–binary-upgrade</td><td align="left">只能由升级工具使用</td></tr><tr><td align="right">–inserts</td><td align="left">以INSERT命令，而不是COPY命令的形式转储数据</td></tr><tr><td align="right">–column-inserts</td><td align="left">以带有列名的INSERT命令形式转储数据</td></tr><tr><td align="right">–disable-dollar-quoting</td><td align="left">取消美元 (符号)引号, 使用 SQL 标准引号</td></tr><tr><td align="right">–disable-triggers</td><td align="left">在只恢复数据的过程中禁用触发器</td></tr><tr><td align="right">–no-tablespaces</td><td align="left">不转储表空间分配信息</td></tr><tr><td align="right">–role=ROLENAME</td><td align="left">在转储前运行SETROLE</td></tr></tbody></table><ol start="3"><li> 联接选项</li></ol><table><thead><tr><th align="right">参数</th><th align="left">作用</th></tr></thead><tbody><tr><td align="right">-h, –host=主机名</td><td align="left">数据库服务器的主机名或套接字目录</td></tr><tr><td align="right">-p, –port=端口号</td><td align="left">数据库服务器的端口号</td></tr><tr><td align="right">-U, –username=用户名</td><td align="left">以指定的数据库用户联接</td></tr><tr><td align="right">-w, –no-password</td><td align="left">永远不提示输入口令</td></tr><tr><td align="right">-W, –password</td><td align="left">强制口令提示 (默认)</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ad-info">For further information, read [www.runoob.com](https://www.runoob.com/manual/PostgreSQL/app-pgdump.html).<br></code></pre></td></tr></table></figure><h2 id="5-4-数据库导入-sql"><a href="#5-4-数据库导入-sql" class="headerlink" title="5.4 数据库导入 *.sql"></a>5.4 数据库导入 <code>*.sql</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">psql -d prodis -U prodis -f /data/tmp/lucas/prodat_vehicle.sql<br></code></pre></td></tr></table></figure><h1 id="6-prodis-使用的端口"><a href="#6-prodis-使用的端口" class="headerlink" title="6. prodis 使用的端口"></a>6. prodis 使用的端口</h1><p>#端口</p><p>TCP:20,21,22,37,80,443,873,2000,2001,4000,5115,5116,5117,5120,9001,44835,44861,3289,9100,139,445,5432<br>UDP:123<br>RR2022:44298</p><h1 id="7-检测端口开启状态"><a href="#7-检测端口开启状态" class="headerlink" title="7. 检测端口开启状态"></a>7. 检测端口开启状态</h1><p>#端口</p><h2 id="7-1-检查UDP端口连接是否工作"><a href="#7-1-检查UDP端口连接是否工作" class="headerlink" title="7.1 检查UDP端口连接是否工作"></a>7.1 检查UDP端口连接是否工作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -vuz &#123;hostIP&#125; &#123;port&#125; <br></code></pre></td></tr></table></figure><h2 id="7-2-检查TCP端口连接是否工作"><a href="#7-2-检查TCP端口连接是否工作" class="headerlink" title="7.2 检查TCP端口连接是否工作"></a>7.2 检查TCP端口连接是否工作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">telnet &#123;hostIP&#125; &#123;port&#125; <br></code></pre></td></tr></table></figure><h1 id="8-Configuration-of-the-database-connection-of-PRODIS-Control"><a href="#8-Configuration-of-the-database-connection-of-PRODIS-Control" class="headerlink" title="8. Configuration of the database connection of PRODIS.Control"></a>8. Configuration of the database connection of PRODIS.Control</h1><p><code>/opt/dsa/prodiscontrol/tomcat/conf/Catalina/localhost/prodis.xml</code>If there are invalid XML characters (those are: &lt;, &gt;, “, ‘, &amp;) in the password, they have to be escaped! E.g. “&amp;” ¬ “&amp;”</p><h1 id="9-SLSE15-配置nameserver但无法ping通外网"><a href="#9-SLSE15-配置nameserver但无法ping通外网" class="headerlink" title="9. SLSE15 配置nameserver但无法ping通外网"></a>9. SLSE15 配置nameserver但无法ping通外网</h1><p>修改<code>/etc/sysconfig/network/routes</code><br>-&gt; </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">default 172.27.8.1  - -<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemectl restart network<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>loop - pseudo device</title>
    <link href="/2022/12/09/loop%20-%20pseudo%20device/"/>
    <url>/2022/12/09/loop%20-%20pseudo%20device/</url>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在类 UNIX 系统里，loop 设备是一种伪设备(pseudo-device)，或者也可以说是仿真设备。它能使我们像块设备一样访问一个文件。</p><p>在使用之前，一个 loop 设备必须要和一个文件进行连接。这种结合方式给用户提供了一个替代块特殊文件的接口。因此，如果这个文件包含有一个完整的文件系统，那么这个文件就可以像一个磁盘设备一样被 mount 起来。</p><p>上面说的文件格式，我们经常见到的是 CD 或 DVD 的 ISO 光盘镜像文件或者是软盘(硬盘)的 *.img 镜像文件。通过这种 loop mount (回环mount)的方式，这些镜像文件就可以被 mount 到当前文件系统的一个目录下。</p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># lsblk</span><br>NAME              MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>loop0               7:0    0     8G  0 loop /data/workstation<br>loop1               7:1    0     2G  0 loop /data/tmp/lucas<br>sda                 8:0    0   500G  0 disk <br>├─sda1              8:1    0     8M  0 part <br>├─sda2              8:2    0   100M  0 part <br>...data omitted...<br>sr0                11:0    1 376.2M  0 rom  <br></code></pre></td></tr></table></figure><h1 id="losetup"><a href="#losetup" class="headerlink" title="losetup"></a>losetup</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># losetup --help</span><br><br>Usage:<br> losetup [options] [&lt;loopdev&gt;]<br> losetup [options] -f | &lt;loopdev&gt; &lt;file&gt;<br><br>Set up and control loop devices.<br><br>Options:<br> -a, --all                     list all used devices<br> -d, --detach &lt;loopdev&gt;...     detach one or more devices<br> -D, --detach-all              detach all used devices<br> -f, --find                    find first unused device<br> -c, --set-capacity &lt;loopdev&gt;  resize the device<br> -j, --associated &lt;file&gt;       list all devices associated with &lt;file&gt;<br> -L, --nooverlap               avoid possible conflict between devices<br><br> -o, --offset &lt;num&gt;            start at offset &lt;num&gt; into file<br>     --sizelimit &lt;num&gt;         device is limited to &lt;num&gt; bytes of the file<br> -b, --sector-size &lt;num&gt;       <span class="hljs-built_in">set</span> the logical sector size to &lt;num&gt;<br> -P, --partscan                create a partitioned loop device<br> -r, --read-only               <span class="hljs-built_in">set</span> up a read-only loop device<br>     --direct-io[=&lt;on|off&gt;]    open backing file with O_DIRECT<br>     --show                    <span class="hljs-built_in">print</span> device name after setup (with -f)<br> -v, --verbose                 verbose mode<br><br> -J, --json                    use JSON --list output format<br> -l, --list                    list info about all or specified (default)<br> -n, --noheadings              don<span class="hljs-string">&#x27;t print headings for --list output</span><br><span class="hljs-string"> -O, --output &lt;cols&gt;           specify columns to output for --list</span><br><span class="hljs-string">     --output-all              output all columns</span><br><span class="hljs-string">     --raw                     use raw --list output format</span><br><span class="hljs-string"></span><br><span class="hljs-string"> -h, --help                    display this help</span><br><span class="hljs-string"> -V, --version                 display version</span><br><span class="hljs-string"></span><br><span class="hljs-string">Available output columns:</span><br><span class="hljs-string">         NAME  loop device name</span><br><span class="hljs-string">    AUTOCLEAR  autoclear flag set</span><br><span class="hljs-string">    BACK-FILE  device backing file</span><br><span class="hljs-string">     BACK-INO  backing file inode number</span><br><span class="hljs-string"> BACK-MAJ:MIN  backing file major:minor device number</span><br><span class="hljs-string">      MAJ:MIN  loop device major:minor number</span><br><span class="hljs-string">       OFFSET  offset from the beginning</span><br><span class="hljs-string">     PARTSCAN  partscan flag set</span><br><span class="hljs-string">           RO  read-only device</span><br><span class="hljs-string">    SIZELIMIT  size limit of the file in bytes</span><br><span class="hljs-string">          DIO  access backing file with direct-io</span><br><span class="hljs-string">      LOG-SEC  logical sector size in bytes</span><br><span class="hljs-string"></span><br><span class="hljs-string">For more details see losetup(8).</span><br></code></pre></td></tr></table></figure><h1 id="找到loop的镜像文件"><a href="#找到loop的镜像文件" class="headerlink" title="找到loop的镜像文件"></a>找到loop的镜像文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># losetup -a </span><br>/dev/loop1: [65025]:13 (/data/.lucas.ext4)<br>/dev/loop0: [65025]:12 (/data/.workstation.ext4)<br></code></pre></td></tr></table></figure><h1 id="创建loop镜像文件"><a href="#创建loop镜像文件" class="headerlink" title="创建loop镜像文件"></a>创建loop镜像文件</h1><h2 id="创建一个文件，大小为2G"><a href="#创建一个文件，大小为2G" class="headerlink" title="创建一个文件，大小为2G"></a>创建一个文件，大小为2G</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># dd if=/dev/zero of=/data/.lucas.ext4 bs=1M count=2048</span><br>2048+0 records <span class="hljs-keyword">in</span><br>2048+0 records out<br>2147483648 bytes (2.1 GB, 2.0 GiB) copied, 14.6235 s, 147 MB/s<br></code></pre></td></tr></table></figure><h2 id="对镜像文件格式化"><a href="#对镜像文件格式化" class="headerlink" title="对镜像文件格式化"></a>对镜像文件格式化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># mkfs.ext4 /data/.lucas.ext4</span><br>mke2fs 1.43.8 (1-Jan-2018)<br>Discarding device blocks: <span class="hljs-keyword">done</span>                            <br>Creating filesystem with 524288 4k blocks and 131072 inodes<br>Filesystem UUID: 079d6ef8-8a05-4d58-9254-f30c05195d86<br>Superblock backups stored on blocks: <br>        32768, 98304, 163840, 229376, 294912<br><br>Allocating group tables: <span class="hljs-keyword">done</span>                            <br>Writing inode tables: <span class="hljs-keyword">done</span>                            <br>Creating journal (16384 blocks): <span class="hljs-keyword">done</span><br>Writing superblocks and filesystem accounting information: <span class="hljs-keyword">done</span> <br></code></pre></td></tr></table></figure><h2 id="以loop挂载镜像文件"><a href="#以loop挂载镜像文件" class="headerlink" title="以loop挂载镜像文件"></a>以loop挂载镜像文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># mount /data/.lucas.ext4 /data/tmp/lucas/</span><br>ANCNHFILSUPSH1A:/data <span class="hljs-comment"># lsblk</span><br>NAME              MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>loop0               7:0    0     8G  0 loop /data/workstation<br>loop1               7:1    0     2G  0 loop /data/tmp/lucas<br>sda                 8:0    0   500G  0 disk <br>├─sda1              8:1    0     8M  0 part <br>├─sda2              8:2    0   100M  0 part <br>...data omitted...<br>sr0                11:0    1 376.2M  0 rom  <br></code></pre></td></tr></table></figure><h1 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h1><h2 id="在镜像后增加2G大小"><a href="#在镜像后增加2G大小" class="headerlink" title="在镜像后增加2G大小"></a>在镜像后增加2G大小</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># dd if=/dev/zero of=/data/.lucas.ext4 bs=1M conv=notrunc oflag=append count=2048</span><br>2048+0 records <span class="hljs-keyword">in</span><br>2048+0 records out<br>2147483648 bytes (2.1 GB, 2.0 GiB) copied, 13.7 s, 157 MB/s<br></code></pre></td></tr></table></figure><h2 id="调整loop配置大小"><a href="#调整loop配置大小" class="headerlink" title="调整loop配置大小"></a>调整loop配置大小</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># losetup -c /dev/loop1</span><br>ANCNHFILSUPSH1A:/data <span class="hljs-comment"># resize2fs -p /dev/loop1 4G</span><br>resize2fs 1.43.8 (1-Jan-2018)<br>Filesystem at /dev/loop1 is mounted on /data/tmp/lucas; on-line resizing required<br>old_desc_blocks = 1, new_desc_blocks = 1<br>The filesystem on /dev/loop1 is now 1048576 (4k) blocks long.<br></code></pre></td></tr></table></figure><h1 id="缩盘"><a href="#缩盘" class="headerlink" title="缩盘"></a>缩盘</h1><h2 id="卸载镜像"><a href="#卸载镜像" class="headerlink" title="卸载镜像"></a>卸载镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># umount /data/.lucas.ext4</span><br></code></pre></td></tr></table></figure><h2 id="检查镜像错误"><a href="#检查镜像错误" class="headerlink" title="检查镜像错误"></a>检查镜像错误</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># e2fsck -f /data/.lucas.ext4</span><br>e2fsck 1.43.8 (1-Jan-2018)<br>Pass 1: Checking inodes, blocks, and sizes<br>Pass 2: Checking directory structure<br>Pass 3: Checking directory connectivity<br>Pass 4: Checking reference counts<br>Pass 5: Checking group summary information<br>/data/.lucas.ext4: 11/262144 files (0.0% non-contiguous), 34894/1048576 blocks<br></code></pre></td></tr></table></figure><h2 id="缩盘-1"><a href="#缩盘-1" class="headerlink" title="缩盘"></a>缩盘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># resize2fs /data/.lucas.ext4 2G</span><br>resize2fs 1.43.8 (1-Jan-2018)<br>Resizing the filesystem on /data/.lucas.ext4 to 524288 (4k) blocks.<br>The filesystem on /data/.lucas.ext4 is now 524288 (4k) blocks long.<br></code></pre></td></tr></table></figure><h2 id="缩小镜像大小"><a href="#缩小镜像大小" class="headerlink" title="缩小镜像大小"></a>缩小镜像大小</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># ll -h ./.lucas.ext4</span><br>-rw-r--r-- 1 root root 4.0G Jul 11 17:05 ./.lucas.ext4<br>ANCNHFILSUPSH1A:/data <span class="hljs-comment"># dd if=/dev/zero of=/data/.lucas.ext4 bs=1M seek=2048 count=0</span><br>0+0 records <span class="hljs-keyword">in</span><br>0+0 records out<br>0 bytes copied, 5.5993e-05 s, 0.0 kB/s<br>ANCNHFILSUPSH1A:/data <span class="hljs-comment"># ll -h ./.lucas.ext4</span><br>-rw-r--r-- 1 root root 2.0G Jul 11 17:06 ./.lucas.ext4<br></code></pre></td></tr></table></figure><h2 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">ANCNHFILSUPSH1A:/data <span class="hljs-comment"># mount /data/.lucas.ext4 /data/tmp/lucas/</span><br>ANCNHFILSUPSH1A:/data <span class="hljs-comment"># lsblk</span><br>NAME              MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT<br>loop0               7:0    0     8G  0 loop /data/workstation<br>loop1               7:1    0     2G  0 loop /data/tmp/lucas<br>sda                 8:0    0   500G  0 disk <br>├─sda1              8:1    0     8M  0 part <br>├─sda2              8:2    0   100M  0 part <br>...data omitted...<br>sr0                11:0    1 376.2M  0 rom  <br>ANCNHFILSUPSH1A:/data <span class="hljs-comment"># df -Th</span><br>Filesystem                Type      Size  Used Avail Use% Mounted on<br>devtmpfs                  devtmpfs  4.0M     0  4.0M   0% /dev<br>tmpfs                     tmpfs     2.3G   58M  2.3G   3% /dev/shm<br>tmpfs                     tmpfs     735M   82M  654M  12% /run<br>tmpfs                     tmpfs     4.0M     0  4.0M   0% /sys/fs/cgroup<br>/dev/mapper/prodis-root   ext4       20G  3.4G   16G  19% /<br>...data ommited...<br>/dev/loop1                ext4      2.0G  6.0M  1.8G   1% /data/tmp/lucas<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>辅助Application测试</title>
    <link href="/2022/12/06/%E8%BE%85%E5%8A%A9Application%E6%B5%8B%E8%AF%95/"/>
    <url>/2022/12/06/%E8%BE%85%E5%8A%A9Application%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<p><em>如题，当APPLICATION组遇到通信问题或数据下载上传问题时，遇到的问题记录如下。</em></p><span id="more"></span><h1 id="1-“Module-name”-无法选中-其他module"><a href="#1-“Module-name”-无法选中-其他module" class="headerlink" title="1. “Module name” 无法选中 其他module"></a>1. “Module name” 无法选中 其他module</h1><blockquote><p>Devices -&gt; Devices -&gt; Data Release Groups -&gt; ➕ </p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> msfd_module;<br></code></pre></td></tr></table></figure><p>-&gt;</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">prodis<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> msfd_module;<br> modulename <span class="hljs-operator">|</span>         recordtime         <span class="hljs-operator">|</span> assignable <span class="hljs-operator">|</span> singleattribute <span class="hljs-operator">|</span> groupable<br><span class="hljs-comment">------------+----------------------------+------------+-----------------+-----------</span><br> config     <span class="hljs-operator">|</span> <span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-04</span> <span class="hljs-number">09</span>:<span class="hljs-number">39</span>:<span class="hljs-number">55.233474</span> <span class="hljs-operator">|</span> Y          <span class="hljs-operator">|</span> Y               <span class="hljs-operator">|</span> N<br> flash3     <span class="hljs-operator">|</span> <span class="hljs-number">2022</span><span class="hljs-number">-06</span><span class="hljs-number">-01</span> <span class="hljs-number">11</span>:<span class="hljs-number">57</span>:<span class="hljs-number">33.620522</span> <span class="hljs-operator">|</span> Y          <span class="hljs-operator">|</span> Y               <span class="hljs-operator">|</span> Y<br> odx        <span class="hljs-operator">|</span> <span class="hljs-number">2022</span><span class="hljs-number">-07</span><span class="hljs-number">-12</span> <span class="hljs-number">17</span>:<span class="hljs-number">23</span>:<span class="hljs-number">56.502474</span> <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> N               <span class="hljs-operator">|</span> N<br> msfd       <span class="hljs-operator">|</span> <span class="hljs-number">2022</span><span class="hljs-number">-07</span><span class="hljs-number">-12</span> <span class="hljs-number">17</span>:<span class="hljs-number">27</span>:<span class="hljs-number">39.39437</span>  <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> N               <span class="hljs-operator">|</span> N<br> odx3       <span class="hljs-operator">|</span> <span class="hljs-number">2022</span><span class="hljs-number">-06</span><span class="hljs-number">-01</span> <span class="hljs-number">11</span>:<span class="hljs-number">57</span>:<span class="hljs-number">33.636093</span> <span class="hljs-operator">|</span> N          <span class="hljs-operator">|</span> N               <span class="hljs-operator">|</span> Y<br>(<span class="hljs-number">5</span> <span class="hljs-keyword">rows</span>)<br><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> msfd_module <span class="hljs-keyword">SET</span> groupable <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Y&#x27;</span> <span class="hljs-keyword">where</span> modulename <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;odx3&#x27;</span>;<br></code></pre></td></tr></table></figure><h1 id="2-“冷启包找不到”"><a href="#2-“冷启包找不到”" class="headerlink" title="2. “冷启包找不到”"></a>2. “冷启包找不到”</h1><blockquote><p>Devices -&gt; Devices -&gt; Setups</p></blockquote><h2 id="2-1-数据库问题"><a href="#2-1-数据库问题" class="headerlink" title="2.1 数据库问题"></a>2.1 数据库问题</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> sysnr, systemid, nametextrefid, langcode, ltext <span class="hljs-keyword">FROM</span> public.prodis_device <span class="hljs-keyword">JOIN</span> i18n_langtext <span class="hljs-keyword">on</span> nametextrefid <span class="hljs-operator">=</span> textrefid;<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">prodis<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> sysnr, systemid, nametextrefid, langcode, ltext <span class="hljs-keyword">FROM</span> public.prodis_device <span class="hljs-keyword">JOIN</span> i18n_langtext <span class="hljs-keyword">on</span> nametextrefid <span class="hljs-operator">=</span> textrefid;<br> sysnr <span class="hljs-operator">|</span> systemid <span class="hljs-operator">|</span> nametextrefid <span class="hljs-operator">|</span> langcode <span class="hljs-operator">|</span>   ltext<br><span class="hljs-comment">-------+----------+---------------+----------+------------</span><br>     <span class="hljs-number">1</span> <span class="hljs-operator">|</span>       <span class="hljs-number">10</span> <span class="hljs-operator">|</span>        <span class="hljs-number">322740</span> <span class="hljs-operator">|</span> de       <span class="hljs-operator">|</span> server<span class="hljs-number">-1</span><br>     <span class="hljs-number">1</span> <span class="hljs-operator">|</span>       <span class="hljs-number">10</span> <span class="hljs-operator">|</span>        <span class="hljs-number">322740</span> <span class="hljs-operator">|</span> en       <span class="hljs-operator">|</span> server<span class="hljs-number">-1</span><br>     <span class="hljs-number">1</span> <span class="hljs-operator">|</span>        <span class="hljs-number">5</span> <span class="hljs-operator">|</span>        <span class="hljs-number">323925</span> <span class="hljs-operator">|</span> de       <span class="hljs-operator">|</span> MFTD2X<span class="hljs-number">-001</span><br>     <span class="hljs-number">2</span> <span class="hljs-operator">|</span>       <span class="hljs-number">10</span> <span class="hljs-operator">|</span>        <span class="hljs-number">323939</span> <span class="hljs-operator">|</span> de       <span class="hljs-operator">|</span> server<span class="hljs-number">-2</span><br>     <span class="hljs-number">2</span> <span class="hljs-operator">|</span>       <span class="hljs-number">10</span> <span class="hljs-operator">|</span>        <span class="hljs-number">323939</span> <span class="hljs-operator">|</span> en       <span class="hljs-operator">|</span> server<span class="hljs-number">-2</span><br>(<span class="hljs-number">5</span> <span class="hljs-keyword">rows</span>)<br><br></code></pre></td></tr></table></figure><p>如果返回结果无返回<code>ltext</code>值则会出现pcontrol加载不出coldstart的情况<br>删除设备后重新添加。</p><h2 id="2-2-文件权限问题"><a href="#2-2-文件权限问题" class="headerlink" title="2.2 文件权限问题"></a>2.2 文件权限问题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">QDAO1A:/export/boot <span class="hljs-comment"># ll</span><br>total 24<br>drwxrwxr-x 2 wwwrun <span class="hljs-built_in">users</span> 4096 Jul  8 23:33 cswindows<br>drwxrwxr-x 5 prodis <span class="hljs-built_in">users</span> 4096 Jul 21 19:38 dpm<br>drwxrwxr-x 3 root   root  4096 Jun 27 17:35 firap2<br>drwxr-xr-x 4 root   root  4096 Jul  8 22:14 global<br>drwxr-xr-x 5    101 <span class="hljs-built_in">users</span> 4096 Jun 27 17:35 mftc<br>drwxrwxr-x 4 root   root  4096 Jun 27 17:35 tester<br></code></pre></td></tr></table></figure><p>应所有所属用户与组为dsa:users</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R dsa:<span class="hljs-built_in">users</span> *<br></code></pre></td></tr></table></figure><h2 id="2-3-dpm服务不正常"><a href="#2-3-dpm服务不正常" class="headerlink" title="2.3 dpm服务不正常"></a>2.3 dpm服务不正常</h2><p>在 <code>/etc/apache2/conf.d</code>文件夹下无<code>dsarpc-dpmservice.conf</code>文件，重新上传以及安装<code>dpmservice-1.8.0-3.4.sle15.x86_64.rpm</code></p><h1 id="3-mft获取车辆信息输出文件-vin文件错误"><a href="#3-mft获取车辆信息输出文件-vin文件错误" class="headerlink" title="3. mft获取车辆信息输出文件*.vin文件错误"></a>3. mft获取车辆信息输出文件<code>*.vin</code>文件错误</h1><p>如果获取的是例如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mftc 20 prodat prodat &lt;VIN&gt;.vin<br></code></pre></td></tr></table></figure><p>而不是一长串</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">3900138    D1A1    2022-10-09T14:48:49       10000054828      VIN <br>...data emmited...<br></code></pre></td></tr></table></figure><p><code>sfd.ini:prodat:fetchprg</code><br>改为<br><code>/opt/dsa/prodis/bin/prodatdistsvr -c %CONTEXT% %KEY%</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">WUH4A:~ <span class="hljs-comment"># getvalue sfd.ini:prodat</span><br>[prodat]<br>module=prodat<br>offline=<br>directory=/export/prodat<br>fetchprg=/opt/dsa/prodis/bin/prodatdistsvr -c %CONTEXT% %KEY%<br>subdiroffset=0<br>subdirlen=5<br>subdirside=r<br>pollinterval=10<br><span class="hljs-built_in">timeout</span>=30<br>fromstdin=1<br>reqsavemode=0<br>remoting=0<br>searchmode=0<br></code></pre></td></tr></table></figure><h1 id="4-odx导入后不可使用"><a href="#4-odx导入后不可使用" class="headerlink" title="4. odx导入后不可使用"></a>4. odx导入后不可使用</h1><p>Production data -&gt; ODX Import -&gt; Overview</p><p><code>Result: Fahrzeugklasse unbekannt</code><br>        车辆    型号    未知</p><h2 id="4-1-配置文件"><a href="#4-1-配置文件" class="headerlink" title="4.1 配置文件"></a>4.1 配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">QDAO1A:/etc/apache2/conf.d <span class="hljs-comment"># cdlog</span><br>QDAO1A:/var/opt/dsa/log <span class="hljs-comment"># less odximport.lg0</span><br></code></pre></td></tr></table></figure><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sas"> 221018 104101.125017 odximport    .  570 [dbapi.cpp   :2664] 0007 Argument <span class="hljs-keyword">list</span> too long: SA_DBMS_API_Error 23503 <span class="hljs-keyword">ERROR</span>:  <span class="hljs-keyword">insert</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">update</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&quot;msfd_context&quot;</span> violates <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> constraint <span class="hljs-string">&quot;msfd_contextfk1&quot;</span><br>DETAIL:  <span class="hljs-keyword">Key</span> (attributename, modulename)=(T2X_CAN_CANFD_DOIP_QingDao, odx3) is <span class="hljs-keyword">not</span> present <span class="hljs-keyword">in</span> <span class="hljs-keyword">table</span> <span class="hljs-string">&quot;msfd_attribute&quot;</span>.<br></code></pre></td></tr></table></figure><p><code>odxdmgr.ini:config:msfdmodule</code> 应为 <code>odx3</code></p><h2 id="4-2-pcontol设置"><a href="#4-2-pcontol设置" class="headerlink" title="4.2 pcontol设置"></a>4.2 pcontol设置</h2><p>Production data -&gt; Configuration -&gt; Data Rel.Attributes</p><p><code>Module name:</code>  <code>odx3</code>   <code>Attribute name:</code>  <code>xxxxxxx</code>   -&gt;   <code>Add attribute</code></p><h1 id="5-选择不了MFT4"><a href="#5-选择不了MFT4" class="headerlink" title="5. 选择不了MFT4"></a>5. 选择不了MFT4</h1><p>Device -&gt; Device -&gt; Device Types</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ad-important">注意页面中是有过滤的<br>![[Pasted image 20221031160331.png]]<br></code></pre></td></tr></table></figure><h2 id="5-1-打开Status下的框框，勾选Inactive"><a href="#5-1-打开Status下的框框，勾选Inactive" class="headerlink" title="5.1 打开Status下的框框，勾选Inactive"></a>5.1 打开<code>Status</code>下的框框，勾选<code>Inactive</code></h2><p>![[ATTACHEMENTS/Pasted image 20221031160450.png]]</p><h2 id="5-2-在最右部分开启。"><a href="#5-2-在最右部分开启。" class="headerlink" title="5.2 在最右部分开启。"></a>5.2 在最右部分开启。</h2><p>![[ATTACHEMENTS/Pasted image 20221031160555.png]]</p><h1 id="6-pcontrol没有中文选项"><a href="#6-pcontrol没有中文选项" class="headerlink" title="6. pcontrol没有中文选项"></a>6. pcontrol没有中文选项</h1><h2 id="6-1-首先看下数据库中有没有zh"><a href="#6-1-首先看下数据库中有没有zh" class="headerlink" title="6.1 首先看下数据库中有没有zh"></a>6.1 首先看下数据库中有没有zh</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> i18n_language;<br></code></pre></td></tr></table></figure><h2 id="6-2-若没有zh，进行如下操作"><a href="#6-2-若没有zh，进行如下操作" class="headerlink" title="6.2 若没有zh，进行如下操作"></a>6.2 若没有zh，进行如下操作</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> i18n_textref (contextid,texttype) <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;s&#x27;</span>);<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> i18n_textref <span class="hljs-keyword">where</span> contextid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;2&#x27;</span>;<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> i18n_language (langcode,nametextrefid,lname,lorder) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;zh&#x27;</span>,$textrefid,<span class="hljs-string">&#x27;中文&#x27;</span>,<span class="hljs-number">3</span>); # 将$textrefid替换为上面得到的textrefid<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> i18n_languagemap (langid,langcode) <span class="hljs-keyword">values</span> (<span class="hljs-number">86</span>,<span class="hljs-string">&#x27;zh&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="6-3-重启jsonres2xml"><a href="#6-3-重启jsonres2xml" class="headerlink" title="6.3 重启jsonres2xml"></a>6.3 重启jsonres2xml</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl restart jsonres2xml-act.service<br></code></pre></td></tr></table></figure><h1 id="7-导入dl24"><a href="#7-导入dl24" class="headerlink" title="7. 导入dl24"></a>7. 导入dl24</h1><p>把dl24包放到/export/dl24/import<br>执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">su - prodis -c <span class="hljs-string">&quot;. /etc/profile.local; umask 002;/opt/dsa/prodis/bin/asvimport -t2 -l asvimport &gt;/dev/null 2&gt;&amp;1 &lt;/dev/null&quot;</span><br></code></pre></td></tr></table></figure><p>关注/var/opt/dsa/log/asvimport.lg0与本身文件夹的result.xml</p><h2 id="7-1-重新导入"><a href="#7-1-重新导入" class="headerlink" title="7.1 重新导入"></a>7.1 重新导入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">UPS-URU1A:/var/opt/dsa/log <span class="hljs-comment"># msfdcontextlist</span><br>+-------------+----------------+--------------------------+---------------------+-------------------+<br>| Module      | Attribute      | Release-Context          | inactivesince       | deleted           |<br>+-------------+----------------+--------------------------+---------------------+-------------------+<br>| dl24        | 2GG            | C5-2GG-2020.12.03-92     |                     |                   |<br>| dl24        | 2GG            | C5-2GG-2021.09.17-112    |                     |                   |<br>| dl24        | 2GG            | C5-2GG-2022.06.20-166    |                     |                   |<br>| dl24        | 2GG            | C5-2GG-2022.09.28-197    |                     |                   |<br>| dl24        | 55D            | 78-55D-2022.11.09-1171   |                     |                   |<br>| dl24        | 604            | C5-604-2020.12.14-373    |                     |                   |<br>| dl24        | 604            | C5-604-2022.02.16-392    |                     |                   |<br>| dl24        | 604            | C5-604-2022.03.11-395    |                     |                   |<br>| dl24        | 604            | C5-604-2022.04.07-395    |                     |                   |<br>| dl24        | 67C            | C5-67C-2022.11.29-54     |                     |                   |<br>| flash       | 2GG            | CW-2GG-2020.10.24-8      |                     |                   |<br>| flash3      | 2GG            | C5-2GG-2020.12.03-92     |                     |                   |<br>| flash3      | 2GG            | C5-2GG-2021.09.17-112    |                     |                   |<br>| flash3      | 2GG            | C5-2GG-2022.06.20-166    |                     |                   |<br>| flash3      | 2GG            | C5-2GG-2022.09.28-197    |                     |                   |<br>| flash3      | 55D            | 78-55D-2022.11.09-1171   |                     |                   |<br>| flash3      | 604            | C5-604-2020.12.14-373    |                     |                   |<br>| flash3      | 604            | C5-604-2022.02.16-392    |                     |                   |<br>| flash3      | 604            | C5-604-2022.03.11-395    |                     |                   |<br>| flash3      | 604            | C5-604-2022.04.07-395    |                     |                   |<br>| flash3      | 67C            | C5-67C-2022.11.29-54     |                     |                   |<br>| odx3        | VW2531CS       | VW2531CS-2.65            |                     |                   |<br>| odx3        | VW2531CS       | VW2531CS-2.71            |                     |                   |<br>| odx3        | VW37XCS        | VW37XCS-2.128            |                     |                   |<br>| odx3        | VW37XCS        | VW37XCS-2.150            |                     |                   |<br>| odx3        | VW37XCS        | VW37XCS-2.159            |                     |                   |<br>+-------------+----------------+--------------------------+---------------------+-------------------+<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfdcontextdel -m dl24 -a 55D -c 78-55D-2022.11.09-1171 -f<br></code></pre></td></tr></table></figure><p> 删掉/export/dl24/release/文件夹<br> 重新导入</p>]]></content>
    
    
    
    <tags>
      
      <tag>DSA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>救援模式挂载lvm出错</title>
    <link href="/2022/11/22/%E6%95%91%E6%8F%B4%E6%A8%A1%E5%BC%8F%E6%8C%82%E8%BD%BDlvm%E5%87%BA%E9%94%99/"/>
    <url>/2022/11/22/%E6%95%91%E6%8F%B4%E6%A8%A1%E5%BC%8F%E6%8C%82%E8%BD%BDlvm%E5%87%BA%E9%94%99/</url>
    
    <content type="html"><![CDATA[<h1 id="1-Description"><a href="#1-Description" class="headerlink" title="1. Description"></a>1. Description</h1><p>有时候当系统遇到无法启动或启动丢失的情况，或进入grub rescue的情况下，在DSA可以使用一个安装过rear备份iso的U盘。</p><span id="more"></span><p>进入系统后</p><h1 id="2-查询物理卷：vgs"><a href="#2-查询物理卷：vgs" class="headerlink" title="2. 查询物理卷：vgs"></a>2. 查询物理卷：vgs</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">DSAServerShare:~:<span class="hljs-comment"># vgs</span><br>  VG        <span class="hljs-comment">#PV #LV #SN Attr   VSize  VFree</span><br>  ubuntu-vg   2   2   0 wz--n- &lt;3.00t    0<br></code></pre></td></tr></table></figure><p>直接挂载硬盘(/dev/sdb3)等可能会出现未知格式为<code>LVM2_member</code><br><code>mount unknown filesystem type ‘lvm2_member’</code></p><h1 id="3-查询逻辑卷：lvdisplay"><a href="#3-查询逻辑卷：lvdisplay" class="headerlink" title="3. 查询逻辑卷：lvdisplay"></a>3. 查询逻辑卷：lvdisplay</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">DSAServerShare:~:<span class="hljs-comment"># lvdisplay</span><br>  --- Logical volume ---<br>  LV Path                /dev/ubuntu-vg/ubuntu-lv<br>  LV Name                ubuntu-lv<br>  VG Name                ubuntu-vg<br>  LV UUID                HGKiZV-7an3-C6yH-K8mp-hxbt-zMb7-lFU81c<br>  LV Write Access        <span class="hljs-built_in">read</span>/write<br>  LV Creation host, time ubuntu-server, 2022-08-17 15:06:55 +0800<br>  LV Status              NOT available<br>  <span class="hljs-comment"># open                 1</span><br>  LV Size                100.00 GiB<br>  Current LE             25600<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently <span class="hljs-built_in">set</span> to     256<br>  Block device           253:0<br><br></code></pre></td></tr></table></figure><h1 id="3-激活逻辑卷"><a href="#3-激活逻辑卷" class="headerlink" title="3. 激活逻辑卷"></a>3. 激活逻辑卷</h1><ul><li><strong>vgchange命令</strong> 用于修改卷组的属性，经常被用来设置卷组是处于活动状态或非活动状态。处于活动状态的卷组无法被删除，必须使用vgchange命令将卷组设置为非活动状态后才能删除。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">DSAServerShare:~:<span class="hljs-comment"># vgchange -ay /dev/ubuntu-vg</span><br>  2 logical volume(s) <span class="hljs-keyword">in</span> volume group <span class="hljs-string">&quot;ubuntu-vg&quot;</span> now active<br></code></pre></td></tr></table></figure></li></ul><h1 id="4-挂载逻辑卷"><a href="#4-挂载逻辑卷" class="headerlink" title="4. 挂载逻辑卷"></a>4. 挂载逻辑卷</h1><p>创建临时文件夹<code>/mnt/*</code>一类的文件夹，然后挂载逻辑卷至临时目录抓紧拷贝有用的文件。</p><p><a href="https://blog.csdn.net/leenhem/article/details/118111370">救援模式挂载lvm出错-mount unknown filesystem type ‘lvm2_member‘解决_leenhem的博客-CSDN博客_lvm2_member</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>DSA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KMS server</title>
    <link href="/2022/11/16/KMS%20server/"/>
    <url>/2022/11/16/KMS%20server/</url>
    
    <content type="html"><![CDATA[<p><em>KMS服务器的搭建与使用。</em><br><em>使用vlmcsd作为服务端。</em></p><span id="more"></span><blockquote><ul><li>vlmcsd is  </li><li>  a replacement for Microsoft’s KMS server</li><li>  It contains vlmcs, a KMS test client, mainly for debugging purposes, that also can “charge” a genuine KMS server</li><li>  designed to run on an always-on or often-on device, e.g. router, NAS Box, …</li><li>  intended to help people who lost activation of their legally-owned licenses, e.g. due to a change of hardware (motherboard, CPU, …)</li></ul></blockquote><p>软件地址：<a href="https://github.com/Wind4/vlmcsd">GitHub - Wind4/vlmcsd: KMS Emulator in C </a></p><h1 id="1-下载到本地"><a href="#1-下载到本地" class="headerlink" title="1. 下载到本地"></a>1. 下载到本地</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@LucasFedoraV3 /lucas<br>0 % git <span class="hljs-built_in">clone</span> https://github.com/Wind4/vlmcsd.git<br>Cloning into <span class="hljs-string">&#x27;vlmcsd&#x27;</span>...<br>remote: Enumerating objects: 1626, <span class="hljs-keyword">done</span>.<br>remote: Counting objects: 100% (12/12), <span class="hljs-keyword">done</span>.<br>remote: Compressing objects: 100% (10/10), <span class="hljs-keyword">done</span>.<br>remote: Total 1626 (delta 2), reused 12 (delta 2), pack-reused 1614<br>Receiving objects: 100% (1626/1626), 12.31 MiB | 737.00 KiB/s, <span class="hljs-keyword">done</span>.<br>Resolving deltas: 100% (847/847), <span class="hljs-keyword">done</span>.<br></code></pre></td></tr></table></figure><h1 id="2-编译"><a href="#2-编译" class="headerlink" title="2. 编译"></a>2. 编译</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@LucasFedoraV3 /lucas/vlmcsd<br>2 master % gmake<br>gmake[1]: Entering directory <span class="hljs-string">&#x27;/lucas/vlmcsd/src&#x27;</span><br>        CC      vlmcs.o &lt;- vlmcs.c<br>        CC      kmsdata-full.o &lt;- kmsdata-full.c<br>        CC      crypto.o &lt;- crypto.c<br>        CC      kms.o &lt;- kms.c<br>        CC      endian.o &lt;- endian.c<br>        CC      output.o &lt;- output.c<br>        CC      shared_globals.o &lt;- shared_globals.c<br>        CC      helpers.o &lt;- helpers.c<br>        CC      network.o &lt;- network.c<br>        CC      rpc.o &lt;- rpc.c<br>        CC      crypto_internal.o &lt;- crypto_internal.c<br>        CC      dns_srv.o &lt;- dns_srv.c<br>kms.c: In <span class="hljs-keyword">function</span> ‘getEpid’:<br>kms.c:502:9: warning: dangling pointer ‘pid’ to ‘ePid’ may be used [-Wdangling-pointer=]<br>  502 |         getEpidFromString(baseResponse, pid);<br>      |         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>kms.c:473:30: note: ‘ePid’ declared here<br>  473 |                         char ePid[PID_BUFFER_SIZE];<br>      |                              ^~~~<br>        CC      vlmcsd.o &lt;- vlmcsd.c<br>        CC      kmsdata.o &lt;- kmsdata.c<br>        LD      ../bin/vlmcs &lt;- vlmcs.o kmsdata-full.o crypto.o kms.o endian.o output.o shared_globals.o helpers.o network.o rpc.o crypto_internal.o dns_srv.o<br>        LD      ../bin/vlmcsd &lt;- vlmcsd.o kmsdata.o crypto.o kms.o endian.o output.o shared_globals.o helpers.o network.o rpc.o crypto_internal.o<br>gmake[1]: Leaving directory <span class="hljs-string">&#x27;/lucas/vlmcsd/src&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="3-将编译好的文件扔到应该到的位置"><a href="#3-将编译好的文件扔到应该到的位置" class="headerlink" title="3. 将编译好的文件扔到应该到的位置"></a>3. 将编译好的文件扔到应该到的位置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@LucasFedoraV3 /lucas/vlmcsd/etc/<br>0 master % <span class="hljs-built_in">cp</span> .* /etc/<br>root@LucasFedoraV3 /lucas/vlmcsd/bin<br>0 master % <span class="hljs-built_in">cp</span> * /usr/bin/<br></code></pre></td></tr></table></figure><h1 id="4-把ini文件转为unix"><a href="#4-把ini文件转为unix" class="headerlink" title="4. 把ini文件转为unix"></a>4. 把ini文件转为unix</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@LucasFedoraV3 /lucas/vlmcsd/bin<br>0 master % dos2unix /etc/vlmcsd.ini<br></code></pre></td></tr></table></figure><h1 id="5-创建kms-pid文件"><a href="#5-创建kms-pid文件" class="headerlink" title="5. 创建kms.pid文件"></a>5. 创建kms.pid文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@LucasFedoraV3 /<br>0 % <span class="hljs-built_in">touch</span> /var/run/kms.pid<br></code></pre></td></tr></table></figure><h1 id="5-配置服务文件"><a href="#5-配置服务文件" class="headerlink" title="5. 配置服务文件"></a>5. 配置服务文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@LucasFedoraV3 /etc<br>0 % vim /usr/lib/systemd/system/kms.service<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=KMS<br><span class="hljs-attr">After</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=forking<br><span class="hljs-attr">PIDFile</span>=/var/run/kms.pid<br><span class="hljs-attr">ExecStart</span>=/usr/bin/vlmcsd -i /etc/vlmcsd.ini<br><span class="hljs-attr">ExecStop</span>=/bin/kill -HUP <span class="hljs-variable">$MAINPID</span><br><span class="hljs-attr">PrivateTmp</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><h1 id="6-启动服务"><a href="#6-启动服务" class="headerlink" title="6. 启动服务"></a>6. 启动服务</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@LucasFedoraV3 /<br>0 % systemctl <span class="hljs-built_in">enable</span> --now kms <br></code></pre></td></tr></table></figure><h1 id="7-使用KMS服务器激活系统-Windows端"><a href="#7-使用KMS服务器激活系统-Windows端" class="headerlink" title="7. 使用KMS服务器激活系统 (Windows端)"></a>7. 使用KMS服务器激活系统 (Windows端)</h1><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">slmgr /skms [KMS IP地址]<br>slmgr /ato<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Firewalld</title>
    <link href="/2022/11/15/Firewalld/"/>
    <url>/2022/11/15/Firewalld/</url>
    
    <content type="html"><![CDATA[<h1 id="1-firewall的原理"><a href="#1-firewall的原理" class="headerlink" title="1 firewall的原理"></a>1 firewall的原理</h1><p>firewall有9个域zone，默认是public域</p><span id="more"></span><table><thead><tr><th>名称</th><th>功能</th><th>配置文件</th></tr></thead><tbody><tr><td>阻塞区域(block)</td><td>任何传入的网络数据包都将会被阻止</td><td>block.xml</td></tr><tr><td>工作区域(work)</td><td>相信网络上的其他计算机不会损害自己的计算机</td><td>work.xml</td></tr><tr><td>家庭区域(home)</td><td>相信网络上的其他计算机不会损害自己的计算机</td><td>home.xml</td></tr><tr><td>公共区域(public)</td><td>不相信网络上的任何计算机，只有选择接受传入的网络计算机</td><td>public.xml</td></tr><tr><td>隔离区域(DMZ)</td><td>隔离区域也被叫做非军事区域，内外网络之间增加的一层网络，起到缓冲作用。对于隔离区域，只有选择接受传入的网络连接</td><td>dmz.xml</td></tr><tr><td>信任区域(trusted)</td><td>所有的网络连接都可以接受</td><td>trusted.xml</td></tr><tr><td>丢弃区域(drop)</td><td>任何传入的网络连接都被拒绝，且不响应</td><td>drop.xml</td></tr><tr><td>内部区域(internal)</td><td>信任网络上的其他计算机，不会损害你的计算机。只有选择接受传入的网络连接</td><td>internal.xml</td></tr><tr><td>外部区域(external)</td><td>不相信网络上的其他计算机，不会损害你的计算机，只有选择接受传入的网络连接</td><td>external.xml</td></tr><tr><td>这些zone的配置文件都保存在<code>/usr/lib/firewallld/zones</code>目录下。默认情况下在<code>/etc/firewalld/zones</code>下面只有一个<code>public.xml</code>。如果给另外一个zone做一些改动，并永久保存，那么就会自动生成对应的配置文件。</td><td></td><td></td></tr><tr><td>比如给work zone增加一个端口</td><td></td><td></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --permanent --zone=work --add-prot=1000/tcp<br></code></pre></td></tr></table></figure><p>那么就会在<code>/usr/lib/firewalld/zones/</code>目录下生成对应的<code>work.xml</code>配置文件。<br>由此可见，firewalld的配置文件其实有两个主要的目录</p><ol><li><code>/usr/lib/firewalld/</code>系统配置文件，尽量不要修改</li><li><code>/etc/firewalld/</code>用户配置文件，可以自行修改</li></ol><p>在<code>/etc/firewalld</code>配置文件目录下面，不止保存了zones的配置文件，还有services文件，也就是<code>/usr/lib/firewalld/services/</code>目录中，每个文件分别对应一项具体的网络服务，通过名字来管理更加高效。</p><h1 id="2-Firewall服务的配置和使用"><a href="#2-Firewall服务的配置和使用" class="headerlink" title="2 Firewall服务的配置和使用"></a>2 Firewall服务的配置和使用</h1><h2 id="2-1-systemctl对防火墙的管理"><a href="#2-1-systemctl对防火墙的管理" class="headerlink" title="2.1 systemctl对防火墙的管理"></a>2.1 systemctl对防火墙的管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start firewalld<span class="hljs-comment"># 起服务</span><br>systemctl stop firewalld <span class="hljs-comment">#停服务</span><br>systemctl <span class="hljs-built_in">enable</span> firewalld <span class="hljs-comment"># 设置防火墙开机自启</span><br>systemctl <span class="hljs-built_in">disable</span> firewalld <span class="hljs-comment"># 关闭防火墙开机自启</span><br>systemctl status firewalld <span class="hljs-comment"># 查看firewalld服务的状态</span><br>systemctl mask firewalld.service<span class="hljs-comment"># 注销服务，执行后无法使用systemctl控制该服务的开启与关闭且开机不会加载该服务</span><br>systemctl unmask firewalld.service <span class="hljs-comment"># 取消注销</span><br></code></pre></td></tr></table></figure><h2 id="2-2-firewall-cmd对防火墙的管理"><a href="#2-2-firewall-cmd对防火墙的管理" class="headerlink" title="2.2 firewall-cmd对防火墙的管理"></a>2.2 firewall-cmd对防火墙的管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --state<span class="hljs-comment"># 显示状态</span><br>firewall-cmd --reload<span class="hljs-comment"># 重载防火墙策略，无需断开链接，动态加载规则</span><br>firewall-cmd --complete-reload <span class="hljs-comment"># 重启防火墙，类似于重启服务</span><br>firewall-cmd --panic-on<span class="hljs-comment"># 任何人都不能访问我这台计算机</span><br>firewall-cmd --panic-off<span class="hljs-comment"># 与上一条命令对应</span><br></code></pre></td></tr></table></figure><h2 id="2-3-对zone和服务的全览（泛查询）"><a href="#2-3-对zone和服务的全览（泛查询）" class="headerlink" title="2.3 对zone和服务的全览（泛查询）"></a>2.3 对zone和服务的全览（泛查询）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --get-zones<span class="hljs-comment"># 查看所有的zone</span><br>firewall-cmd --get-default-zone<span class="hljs-comment"># 查看默认的zone</span><br>firewall-cmd --get-active-zones<span class="hljs-comment"># 查看活跃的zone</span><br>firewall-cmd --get-zone-of-interface=ens33<span class="hljs-comment"># 查看ens33接口所属区域</span><br>firewall-cmd --get-services<span class="hljs-comment"># 查看所有的服务</span><br></code></pre></td></tr></table></figure><h2 id="2-4-对某个zone下的服务查看，可以配合”–zone-域”使用"><a href="#2-4-对某个zone下的服务查看，可以配合”–zone-域”使用" class="headerlink" title="2.4 对某个zone下的服务查看，可以配合”–zone=域”使用"></a>2.4 对某个zone下的服务查看，可以配合”–zone=域”使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --list-all<span class="hljs-comment"># 列出指定的zone的规则，如果不指定zone默认查看当前活跃zone的规则</span><br>firewall-cmd --list-source<span class="hljs-comment"># 列出源IP</span><br>firewall-cmd --list-source-ports<span class="hljs-comment"># 列出源端口</span><br>firewall-cmd --list-ports<span class="hljs-comment"># 列出端口</span><br>firewall-cmd --list-services<span class="hljs-comment"># 列出活跃zone下的服务</span><br></code></pre></td></tr></table></figure><h2 id="2-5-对服务、端口等的设置与添加，策略的设置"><a href="#2-5-对服务、端口等的设置与添加，策略的设置" class="headerlink" title="2.5 对服务、端口等的设置与添加，策略的设置"></a>2.5 对服务、端口等的设置与添加，策略的设置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --set-default-zone=work<span class="hljs-comment"># 设置默认zone</span><br>firewall-cmd --add-interface=ens33<span class="hljs-comment"># 添加接口</span><br>firewall-cmd --add-source=192.168.0.21<span class="hljs-comment"># 添加源地址</span><br>firewall-cmd --add-service=dhcp<span class="hljs-comment"># 添加服务</span><br>firewall-cmd --add-port=80/tcp<span class="hljs-comment"># 添加端口</span><br>firewall-cmd --add-masquerade<span class="hljs-comment"># 开启内核路由转发功能，其等同于以下改法</span><br>vim /etc/sysctl.conf修改net.ipv4.ip_forward = 1<br>firewall-cmd --add-icmp-block=echo-request<span class="hljs-comment"># 禁止ping</span><br>firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080<br><span class="hljs-comment"># 设置80到8080端口转发，add-forward-prot=后面的内容以冒号分隔，正好是三对,源端口：协议：目标端口</span><br></code></pre></td></tr></table></figure><h2 id="2-6-对策略的删除"><a href="#2-6-对策略的删除" class="headerlink" title="2.6 对策略的删除"></a>2.6 对策略的删除</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --remove-sevice=dhcp<span class="hljs-comment"># 删除服务</span><br>firewall-cmd --remove-port=80/tcp<span class="hljs-comment"># 删除端口</span><br>firewall-cmd --panic-on<span class="hljs-comment"># 丢弃</span><br>firewall-cmd --query-panic<span class="hljs-comment"># 查询丢弃状态</span><br>firewall-cmd --panic-off<span class="hljs-comment"># 取消丢弃</span><br></code></pre></td></tr></table></figure><h2 id="2-7-永久生效"><a href="#2-7-永久生效" class="headerlink" title="2.7 永久生效"></a>2.7 永久生效</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --permanent ...<span class="hljs-comment"># 如果想要永久生效，就在firewall-cmd后边加一个--permanent参数</span><br></code></pre></td></tr></table></figure><h1 id="3-富规则"><a href="#3-富规则" class="headerlink" title="3 富规则"></a>3 富规则</h1><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coq">rule<br>    [source]<br>    [destination]<br>    service|<span class="hljs-type">port</span>|<span class="hljs-type">protocol</span>|<span class="hljs-type">icmp</span>-block|<span class="hljs-type">icmp</span>-type|<span class="hljs-type">masquerade</span>|<span class="hljs-type">forward</span>-port|<span class="hljs-type">source</span>-port<br>    [log]<br>    [audit]<br>    [accept|<span class="hljs-type">reject</span>|<span class="hljs-type">drop</span>|<span class="hljs-type">mark</span>]<br></code></pre></td></tr></table></figure><p>e.g.:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">firewall-cmd --add-rich-rules=<span class="hljs-string">&#x27;rule family=ipv4 source not address=192.168.0.200 destination address=192.168.0.33 accept&#x27;</span><br><span class="hljs-comment"># 源地址不是192.168.0.200目标地址是192.168.0.33的情况，允许通过</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  
  
  
  <entry>
    <title>404</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>About</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>archive</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
  <entry>
    <title>tag</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
</search>
